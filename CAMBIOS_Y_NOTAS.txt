Proyecto: Skater Store / SkaterShop (Next.js + Zustand)
Repositorio remoto (p√∫blico): https://github.com/internationalskateboard-dev/skatershop.git
Versi√≥n base documentada: SKATER-SYNC2-V1.0
Fuente local original: skater-store-sync2.zip
Fecha de esta actualizaci√≥n: 2025-10-31
Nota: este documento es la gu√≠a de sincronizaci√≥n entre lo que hablamos aqu√≠ y lo que est√° en GitHub. TODO cambio aceptado aqu√≠ debe reflejarse en este archivo y luego subirse al repo en la rama/main correspondiente.

============================================================
0. OBJETIVO DE ESTA VERSI√ìN
============================================================
- Consolidar la estructura real del repo p√∫blico `skatershop`.
- Dejar clara la separaci√≥n de componentes: /components/layout y /components/ui.
- Unificar el tipado de productos y ventas en un solo lugar: lib/types.ts.
- Actualizar el hook de cat√°logo: lib/useMergedProducts.ts para que soporte API + fallback local.
- Documentar las nuevas rutas de API: /api/products, /api/sales, /api/checkout.
- Unificar el uso de la imagen placeholder en TODA la app.
- Dejar lista la base para migrar el admin a API (siguiente paso).

============================================================
1. ESTRUCTURA PRINCIPAL DEL PROYECTO
============================================================
El proyecto est√° organizado con Next.js 13+ (App Router) y orientaci√≥n a e-commerce con estado en cliente (Zustand).

- app/
  - layout.tsx           ‚Üê layout ra√≠z, monta Navbar
  - page.tsx             ‚Üê landing / home actual
  - shop/
    - page.tsx           ‚Üê cat√°logo principal
  - products/
    - [id]/
      - page.tsx         ‚Üê detalle de producto
  - cart/
    - page.tsx           ‚Üê carrito
  - checkout/
    - page.tsx           ‚Üê checkout con PayPal sandbox
  - admin/
    - page.tsx           ‚Üê panel admin simple (password en cliente)
  - api/
    - products/
      - route.ts         ‚Üê GET/POST de productos (versi√≥n pre-backend)
    - sales/
      - route.ts         ‚Üê GET/POST de ventas
    - checkout/
      - route.ts         ‚Üê validaci√≥n de stock + registro de venta + reducci√≥n de stock
  - (futuro)
    - uploads/route.ts   ‚Üê para mover im√°genes base64 a archivos reales
    - auth/...           ‚Üê s√≥lo si se habilita autenticaci√≥n

- components/
  - layout/
    - Navbar.tsx         ‚Üê header global, oculta carrito en /admin
    - ClientOnly.tsx     ‚Üê wrapper para evitar hydration mismatch
    - CartBadge.tsx      ‚Üê contador animado del carrito (framer-motion)
  - ui/
    - ProductCard.tsx    ‚Üê tarjeta de producto para /shop
    - (futuras tarjetas, modales, botones reutilizables)

- store/   (Zustand)
  - cartStore.ts         ‚Üê carrito persistente con talla
  - productStore.ts      ‚Üê productos creados desde admin
  - salesStore.ts        ‚Üê registro de ventas en memoria

- lib/
  - types.ts             ‚Üê tipos compartidos: Product, SaleItem, SaleRecord
  - constants.ts         ‚Üê PRODUCT_PLACEHOLDER_IMAGE
  - productsBase.ts      ‚Üê productos mock base (cat√°logo inicial)
  - useMergedProducts.ts ‚Üê hook que unifica API + store local + base

- public/
  - images/
    - logo-skater-yellow.svg
    - placeholder.png     ‚Üê 800x800, gris oscuro, texto ‚ÄúSKATER STORE ‚Äì NO IMAGE‚Äù
    - (otras im√°genes de productos)

- tailwind.config.(js|ts)
- postcss.config.js
- tsconfig.json           ‚Üê con alias "@/..." ya configurado

============================================================
2. DESCRIPCI√ìN DE RUTAS (APP ROUTER)
============================================================

------------------------------------------------------------
2.1 app/layout.tsx
------------------------------------------------------------
- Renderiza el <html> y <body>.
- Incluye el <Navbar /> de forma global.
- Usa el theme oscuro por defecto.
- Navbar detecta ruta con usePathname():
  - si pathname empieza por /admin ‚Üí no muestra enlace de carrito.

------------------------------------------------------------
2.2 app/page.tsx (Home)
------------------------------------------------------------
- P√°gina inicial sencilla.
- Explica la tienda y lleva a /shop.
- NO es el cat√°logo.

------------------------------------------------------------
2.3 app/shop/page.tsx (Cat√°logo principal)
------------------------------------------------------------
- Muestra la tienda real.
- Obtiene los productos desde el hook actualizado: lib/useMergedProducts.ts
  - 1) intenta GET /api/products
  - 2) si falla ‚Üí usa productos del store local (admin)
  - 3) siempre mezcla con lib/productsBase.ts
  - 4) los productos de API o admin pisan a los base si tienen el mismo id
- Muestra bot√≥n ‚ÄúCarrito (N)‚Äù con useCartStore().countItems()
- Renderiza cada producto con <ProductCard product={p} />
- Soporta imagen faltante porque la tarjeta usa el placeholder global.

------------------------------------------------------------
2.4 app/products/[id]/page.tsx (Detalle de producto)
------------------------------------------------------------
- P√°gina din√°mica: /products/{id}
- Busca el producto dentro del array unificado (el mismo que usa /shop)
- Muestra:
  - Imagen grande con fallback
  - Nombre / descripci√≥n / detalles
  - Precio seguro: ‚Ç¨{Number(product.price ?? 0).toFixed(2)}
  - Selector de talla si el producto tiene sizes[]
- Comportamientos clave:
  - Si el producto ya est√° en el carrito ‚Üí bot√≥n ‚ÄúYa en carrito ‚úÖ‚Äù
  - Si el usuario cambia de talla estando en carrito ‚Üí llama a cartStore.setItemSize(id, size) y muestra toast verde ‚ÄúTalla cambiada en el carrito ‚úÖ‚Äù
  - Si el producto tiene tallas y no se ha elegido ‚Üí muestra toast rojo ‚ÄúSelecciona una talla antes de a√±adir.‚Äù
  - Al a√±adir se muestra bot√≥n de ‚ÄúPagar‚Äù en m√≥vil

------------------------------------------------------------
2.5 app/cart/page.tsx (Carrito)
------------------------------------------------------------
- Usa <ClientOnly> para renderizar en cliente.
- Usa useCartStore() para:
  - listar items
  - actualizar cantidad
  - quitar producto
  - vaciar carrito
  - calcular total
- Cada l√≠nea muestra:
  - imagen (siempre con PRODUCT_PLACEHOLDER_IMAGE si no hay)
  - nombre
  - talla (si existe en el item)
  - precio unitario seguro
  - controles +/- que no permiten bajar de 1
  - subtotal del producto
- Acciones al final:
  - ‚ÄúIr al Checkout ‚Üí /checkout‚Äù
  - ‚ÄúSeguir comprando ‚Üí /shop‚Äù

------------------------------------------------------------
2.6 app/checkout/page.tsx (Checkout con PayPal)
------------------------------------------------------------
- 2 columnas:
  1) Formulario de Env√≠o & Contacto (todos los campos obligatorios)
  2) Resumen del pedido
- Resumen del pedido:
  - lista de items del carrito
  - miniatura siempre con PRODUCT_PLACEHOLDER_IMAGE
  - talla (si tiene)
  - qty √ó precio
  - totales de productos, env√≠o, descuento y total
- Pago:
  - PayPal en sandbox (`clientId: "test"`)
  - Antes de crear la orden:
    - consulta el productStore en memoria
    - si falta stock ‚Üí corta el proceso
  - Al aprobar:
    - construye un batch ‚Üí [{ productId, qty }]
    - llama a salesStore.addSaleBatch(batch)
    - llama a productStore.reduceStockBatch(batch)
    - limpia el carrito
    - muestra tarjeta verde ‚ÄúPago completado‚Äù
- Est√©tica: se mantiene la que pediste (‚Äúno tocar la est√©tica‚Äù)
- Bot√≥n ‚ÄúVaciar carrito‚Äù queda comentado en el header, como en tu versi√≥n original.

------------------------------------------------------------
2.7 app/admin/page.tsx (Panel Admin)
------------------------------------------------------------
- P√°gina con autenticaci√≥n muy simple en cliente: contrase√±a ‚Äúskateradmin‚Äù, guardada en sessionStorage.
- Al autenticarse:
  - muestra formulario de producto (id, name, price, stock, desc, details, sizes, image)
  - muestra la lista de productos existentes
  - permite cargar imagen en base64 para no depender de backend
  - permite clonar un producto bloqueado como nuevo (`-v2`)
- EN ESTA FASE: el admin sigue escribiendo en el store local (Zustand),
  pero ya tenemos las rutas /api/products para migrarlo.

============================================================
3. API ROUTES (BACKEND DENTRO DEL MISMO PROYECTO)
============================================================
Estas rutas est√°n dentro de app/api/ y son parte del mismo proyecto Next.js. Son el primer paso hacia un backend real. Se documentan aqu√≠ porque el usuario pidi√≥ ‚Äúmixto todo‚Äù.

------------------------------------------------------------
3.1 app/api/products/route.ts
------------------------------------------------------------
M√©todos:
- GET
  - Devuelve la lista de productos que est√°n actualmente en el store local (`useProductStore.getState().products`)
  - Respuesta:
    {
      ok: true,
      count: number,
      products: Product[]
    }
- POST
  - Crea o actualiza un producto.
  - Requiere: id, name, price
  - Guarda en el store.
  - ‚ö†Ô∏è A√∫n sin autenticaci√≥n (pendiente fase backend real).

Uso previsto:
- El admin (frontend) puede empezar a usar este endpoint para crear/editar productos.
- `useMergedProducts` ya est√° preparado para leer desde aqu√≠ primero.

------------------------------------------------------------
3.2 app/api/sales/route.ts
------------------------------------------------------------
M√©todos:
- GET
  - Devuelve todo el historial de ventas (salesStore)
- POST
  - Registra una venta con el mismo formato que usa el checkout:
    { items: [{ productId, qty, size? }], customer?, total? }

Uso previsto:
- Dashboard de admin en el futuro.
- Integraci√≥n con reportes.

------------------------------------------------------------
3.3 app/api/checkout/route.ts
------------------------------------------------------------
M√©todo:
- POST
  - Recibe:
    {
      items: [{ productId, qty, size? }, ...],
      customer?: {...},
      total?: number
    }
  - Valida stock en productStore
  - Si hay productos sin stock ‚Üí responde 409 con detalle
  - Si est√° todo bien:
    - registra la venta en salesStore
    - reduce stock en productStore
    - responde 201 OK

Uso previsto:
- M√°s adelante, mover la l√≥gica de PayPal a server-side y llamar a este endpoint desde el cliente.
- Reemplazar la validaci√≥n que ahora est√° en el componente.

============================================================
4. LIBRER√çAS / HOOKS / CONSTANTES
============================================================

------------------------------------------------------------
4.1 lib/types.ts
------------------------------------------------------------
Tipos compartidos entre frontend (p√°ginas), stores (Zustand) y API (app/api/...):
- Product
  - id: string
  - name: string
  - price: number
  - desc?: string
  - details?: string
  - image?: string
  - sizes?: string[]
  - stock?: number
  - locked?: boolean
- SaleItem
  - productId: string
  - qty: number
  - size?: string
- SaleRecord
  - id: string
  - items: SaleItem[]
  - createdAt: string
  - total?: number
  - customer?: { fullName?, email?, phone?, country? }

------------------------------------------------------------
4.2 lib/constants.ts
------------------------------------------------------------
- PRODUCT_PLACEHOLDER_IMAGE = "/images/placeholder.png"
  - Se usa en:
    - components/ui/ProductCard.tsx
    - app/shop/page.tsx
    - app/products/[id]/page.tsx
    - app/cart/page.tsx
    - app/checkout/page.tsx

------------------------------------------------------------
4.3 lib/productsBase.ts
------------------------------------------------------------
- Array de productos iniciales tipados como Product[]
- Se mezcla SIEMPRE con los productos del admin o de la API
- Los productos del admin/API pisan a los base si coinciden por id

------------------------------------------------------------
4.4 lib/useMergedProducts.ts (actualizado 2025-10-31)
------------------------------------------------------------
- NUEVO COMPORTAMIENTO:
  1. Intenta fetch("/api/products") ‚Üí si responde OK, usa esos.
  2. Si falla, no existe la ruta, o no hay backend ‚Üí usa store/productStore.ts (admin).
  3. Siempre a√±ade lib/productsBase.ts y, si hay repetidos, los de API/admin ganan.
- Devuelve:
  - products: Product[]
  - loading: boolean
  - error: string | null
  - source: "api" | "local"
- NOTA: esta doble fuente (API + local) es PROVISIONAL. Cuando el backend est√© estable, eliminar el fallback local y dejar solo la API.

============================================================
5. STORES (ZUSTAND)
============================================================

------------------------------------------------------------
5.1 store/cartStore.ts (actualizado)
------------------------------------------------------------
- Carrito persistente con:
  - id, name, price, qty, image?, size?
- addToCart:
  - si el item ya existe ‚Üí suma qty, actualiza imagen (si lleg√≥), actualiza talla (si lleg√≥)
  - si no existe ‚Üí lo a√±ade con placeholder si no hay imagen
- updateQty:
  - nunca deja cantidad < 1
- setItemSize:
  - pensado para lo que hace /products/[id]
- total:
  - suma segura con Number(...) para evitar NaN
- countItems:
  - cuenta unidades totales
- persistencia:
  - clave: "skatershop-cart-v1"

------------------------------------------------------------
5.2 store/productStore.ts (actualizado)
------------------------------------------------------------
- Usa tipo Product de lib/types.ts
- Reexporta el tipo Product para compatibilidad:
  - `export type { Product } from "@/lib/types";`
- M√©todos:
  - addProduct(p)
  - updateProduct(id, data)
  - deleteProduct(id)
  - reduceStockBatch(batch)
  - markLocked(id)
  - findById(id)
- persistencia: "skatershop-products-v1"

------------------------------------------------------------
5.3 store/salesStore.ts (actualizado)
------------------------------------------------------------
- Usa tipos SaleItem y SaleRecord de lib/types.ts
- addSaleBatch(items, extra?)
  - se usa en checkout y en /api/sales
- getSoldQty(productId)
  - se usa en admin para decidir si mostrar ‚ÄúLOCKED‚Äù
- persistencia: "skatershop-sales-v1"

============================================================
6. COMPONENTES PRINCIPALES
============================================================

------------------------------------------------------------
6.1 components/layout/Navbar.tsx
------------------------------------------------------------
- Detecta /admin y oculta carrito.
- Muestra logo SVG.
- Enlaces: Home, Tienda, Carrito.
- Usa <CartBadge /> cuando no est√°s en admin.

------------------------------------------------------------
6.2 components/layout/CartBadge.tsx
------------------------------------------------------------
- Client component.
- Lee countItems() desde cartStore.
- Animaci√≥n con framer-motion.

------------------------------------------------------------
6.3 components/ui/ProductCard.tsx (actualizado)
------------------------------------------------------------
- Tipado de producto (sin any).
- A√±adir directo si no hay o hay 1 talla.
- Si hay varias tallas ‚Üí redirige al detalle.
- Usa PRODUCT_PLACEHOLDER_IMAGE.
- Precio seguro: Number(product.price ?? 0).toFixed(2)

------------------------------------------------------------
6.4 components/layout/ClientOnly.tsx
------------------------------------------------------------
- Renderiza hijos solo en cliente.
- Usado en /cart, /shop y otros que lean Zustand.

============================================================
7. CONVENCI√ìN DE VERSIONADO
============================================================
- Palabra clave: SKATER-SYNC2-V1.0
  - esta es la versi√≥n que proviene de skater-store-sync2.zip
  - a partir de aqu√≠, todo cambio de estructura o API se anota debajo
- Para siguientes sincronizaciones:
  - SYNC-GIT ‚Üí indicar √∫ltimo commit de GitHub
  - aplicar cambios aqu√≠
  - subir al repo

============================================================
8. PENDIENTE / PR√ìXIMOS PASOS
============================================================
- Migrar app/admin/page.tsx para que:
  - lea lista desde GET /api/products
  - cree/edite usando POST /api/products
  - si la API falla ‚Üí caiga al store local (fallback)

- Extraer im√°genes base64 del admin a una ruta /api/uploads o a /public/uploads
- A√±adir vista Home de contenido (no solo /shop)
- A√±adir control de no mostrar mini carrito en m√≥vil dentro de detalle
- Conectar checkout con backend real (PayPal + validaci√≥n server-side)
- A√±adir autenticaci√≥n b√°sica para /admin
- Una vez el backend est√© estable ‚Üí quitar el fallback ‚Äúlocal‚Äù del hook useMergedProducts

============================================================
FIN DEL ARCHIVO
============================================================


## üü° Actualizaci√≥n: 2025-10-31 ‚Äî Integraci√≥n completa de Checkout con API  
**Versi√≥n interna:** `SKATER-SYNC2-V1.1`  
**Rama base:** `main`  
**Repositorio:** [internationalskateboard-dev/skatershop](https://github.com/internationalskateboard-dev/skatershop)

---

### ‚úÖ Cambios principales

#### **1. API /api/products actualizada**
- Se crea **`app/api/products/route.ts`** con soporte total a los nuevos campos:
  - `colors` ‚Üí array con `{ name, image }`
  - `sizeGuide` ‚Üí texto o tabla de medidas
- Usa los m√©todos de `useProductStore` (`findById`, `addProduct`, `updateProduct`).
- Crea o actualiza productos autom√°ticamente sin perder metadatos.
- Devuelve estructura uniforme `{ ok, product }`.
- Compatible con futura base de datos (persistencia pendiente).

---

#### **2. API /api/checkout implementada**
- Nuevo endpoint **`app/api/checkout/route.ts`** para registrar ventas.
- Entrada esperada:
  ```json
  {
    "items": [{ "productId": "hoodie-black", "qty": 2, "size": "L" }],
    "customer": {
      "fullName": "...",
      "email": "...",
      "phone": "...",
      "country": "...",
      "adresse": "...",
      "city": "...",
      "zip": "..."
    },
    "total": 59.98
  }
